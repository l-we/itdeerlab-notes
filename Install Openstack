

systemctl status firewalld
systemctl stop firewalld
systemctl disable firewalld
setenforce 0
yum update -y
vim /etc/hosts

systemctl stop NetworkManager
systemctl status NetworkManager
systemctl disable NetworkManager


vim /etc/selinux/config 
cat /etc/selinux/config 

yum install -y https://repos.fedorapeople.org/repos/openstack/openstack-newton/rdo-release-newton-5.noarch.rpm

yum -y install openstack-packstack

packstack --gen-answer-file=openstacktest-answere-file.txt

packstack --answer-file=openstacktest-answere-file.txt

[root@demo ~]# packstack --answer-file=openstacktest-answere-file.txt
Welcome to the Packstack setup utility

The installation log file is available at: /var/tmp/packstack/20180325-220553-kpDVtI/openstack-setup.log

Installing:
Clean Up                                             [ DONE ]
Discovering ip protocol version                      [ DONE ]
Setting up ssh keys                                  [ DONE ]
Preparing servers                                    [ DONE ]
Pre installing Puppet and discovering hosts' details [ DONE ]
Preparing pre-install entries                        [ DONE ]
Setting up CACERT                                    [ DONE ]
Preparing AMQP entries                               [ DONE ]
Preparing MariaDB entries                            [ DONE ]
Fixing Keystone LDAP config parameters to be undef if empty[ DONE ]
Preparing Keystone entries                           [ DONE ]
Preparing Glance entries                             [ DONE ]
Checking if the Cinder server has a cinder-volumes vg[ DONE ]
Preparing Cinder entries                             [ DONE ]
Preparing Nova API entries                           [ DONE ]
Creating ssh keys for Nova migration                 [ DONE ]
Gathering ssh host keys for Nova migration           [ DONE ]
Preparing Nova Compute entries                       [ DONE ]
Preparing Nova Scheduler entries                     [ DONE ]
Preparing Nova VNC Proxy entries                     [ DONE ]
Preparing OpenStack Network-related Nova entries     [ DONE ]
Preparing Nova Common entries                        [ DONE ]
Preparing Neutron LBaaS Agent entries                [ DONE ]
Preparing Neutron API entries                        [ DONE ]
Preparing Neutron L3 entries                         [ DONE ]
Preparing Neutron L2 Agent entries                   [ DONE ]
Preparing Neutron DHCP Agent entries                 [ DONE ]
Preparing Neutron Metering Agent entries             [ DONE ]
Checking if NetworkManager is enabled and running    [ DONE ]
Preparing OpenStack Client entries                   [ DONE ]
Preparing Horizon entries                            [ DONE ]
Preparing Puppet manifests                           [ DONE ]
Copying Puppet modules and manifests                 [ DONE ]
Applying 192.168.1.85_controller.pp
Testing if puppet apply is finished: 192.168.1.85_controller.pp  [ \ ]Testing if puppet apply is finished: 192.168.1.85_controller.pp  [ -Testing if puppet apply is finished: 192.168.1.85_controller.pp  [ /192.168.1.85_controller.pp:                          [ DONE ]         
Applying 192.168.1.85_network.pp
192.168.1.85_network.pp:                             [ DONE ]      
Applying 192.168.1.85_compute.pp
192.168.1.85_compute.pp:                             [ DONE ]      
Applying Puppet manifests                            [ DONE ]
Finalizing                                           [ DONE ]

 **** Installation completed successfully ******

Additional information:
 * Time synchronization installation was skipped. Please note that unsynchronized time on server instances might be problem for some OpenStack components.
 * File /root/keystonerc_admin has been created on OpenStack client host 192.168.1.85. To use the command line tools you need to source the file.
 * To access the OpenStack Dashboard browse to http://192.168.1.85/dashboard .
Please, find your login credentials stored in the keystonerc_admin in your home directory.
 * Because of the kernel update the host 192.168.1.85 requires reboot.
 * The installation log file is available at: /var/tmp/packstack/20180325-220553-kpDVtI/openstack-setup.log
 * The generated manifests are available at: /var/tmp/packstack/20180325-220553-kpDVtI/manifests


















vim /etc/neutron/plugin.ini

type_drivers = vxlan,flat
flat_networks = *

systemctl restart neutron-server.service
systemctl status neutron-server.service


vim /etc/neutron/plugins/ml2/openvswitch_agent.ini

bridge_mappings = physnet1:br-ex

systemctl restart neutron-openvswitch-agent.service
systemctl status neutron-openvswitch-agent.service


vim /etc/neutron/l3_agent.ini

external_network_bridge =

systemctl restart neutron-l3-agent.service
systemctl status neutron-l3-agent.service



cat keystonerc_admin
unset OS_SERVICE_TOKEN
    export OS_USERNAME=admin
    export OS_PASSWORD=4608b94207ca4a8c
    export OS_AUTH_URL=http://192.168.1.85:5000/v2.0
    export PS1='[\u@\h \W(keystone_admin)]\$ '
    
export OS_TENANT_NAME=admin
export OS_REGION_NAME=RegionOne


source keystonerc_admin

neutron net-create linuxtopic-external --provider:network_type flat --provider:physical_network physnet1 --router:external=True --shared


ssh -i cloud.key <username>@<instance_ip>


e5e92790cea44e99











### set log levels ###
log4j.rootLogger = debug ,  stdout ,  D ,  E

### 输出到控制台 ###
log4j.appender.stdout = org.apache.log4j.ConsoleAppender
log4j.appender.stdout.Target = System.out
log4j.appender.stdout.layout = org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern =  %d{ABSOLUTE} %5p %c{ 1 }:%L - %m%n

### 输出到日志文件 ###
log4j.appender.D = org.apache.log4j.DailyRollingFileAppender
log4j.appender.D.File = logs/log.log
log4j.appender.D.Append = true
log4j.appender.D.Threshold = DEBUG ## 输出DEBUG级别以上的日志
log4j.appender.D.layout = org.apache.log4j.PatternLayout
log4j.appender.D.layout.ConversionPattern = %-d{yyyy-MM-dd HH:mm:ss}  [ %t:%r ] - [ %p ]  %m%n

### 保存异常信息到单独文件 ###
log4j.appender.D = org.apache.log4j.DailyRollingFileAppender
log4j.appender.D.File = logs/error.log ## 异常日志文件名
log4j.appender.D.Append = true
log4j.appender.D.Threshold = ERROR ## 只输出ERROR级别以上的日志!!!
log4j.appender.D.layout = org.apache.log4j.PatternLayout
log4j.appender.D.layout.ConversionPattern = %-d{yyyy-MM-dd HH:mm:ss}  [ %t:%r ] - [ %p ]  %m%n